---
title: "MKMapViewã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–¹è§’ã‚’è¡¨ç¤ºã—ã€ã‚«ãƒ¡ãƒ©ã®è‡ªå‹•å›è»¢ã‚’ç„¡åŠ¹ã«ã™ã‚‹"
emoji: "ğŸ¾"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["swift"]
published: true
publication_name: "karabiner_inc"
---

# ã¯ã˜ã‚ã«
MKMapViewã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–¹è§’ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€`userTrackingMode`ã‚’`followWithHeading`ã«ã™ã‚Œã°è‰¯ã„ã§ã™ã€‚
```swift
mapView.userTrackingMode = .followWithHeading
```

ã“ã‚Œã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–¹å‘ã‚’è¡¨ç¤ºã§ãã‚‹ã®ã§ã™ãŒã€ã‚«ãƒ¡ãƒ©ãŒè‡ªå‹•ã§å›è»¢ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–¹è§’è¡¨ç¤ºã‚’è‡ªå‰å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€è¦ä»¶ã‚’æº€ãŸã™ã“ã¨ãŒã§ããŸã®ã§ã€æ–¹æ³•ã‚’å…±æœ‰ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

# å®Ÿè£…æ–¹é‡
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨åœ°ã‚’è¡¨ç¤ºã™ã‚‹
1. ç¾åœ¨åœ°ã‚’è¡¨ã™Annotationã®ç”»åƒã‚’åˆ¥ç”»åƒã«å¤‰æ›´
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–¹è§’ã‚’å–å¾—ã—ã€ç”»åƒã‚’å›è»¢ã•ã›ã‚‹

## 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨åœ°ã‚’è¡¨ç¤ºã™ã‚‹
```swift
mapView.showsUserLocation = true
```

## 2. ç¾åœ¨åœ°ã‚’è¡¨ã™Annotationã®ç”»åƒã‚’åˆ¥ç”»åƒã«å¤‰æ›´
MKMapViewã®ãƒ‡ãƒªã‚²ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨åœ°ã‚’è¡¨ã™Annottionã®ç”»åƒã‚’æ›¸ãæ›ãˆã‚‹ã€‚
ãã—ã¦ã€ã‚¯ãƒ©ã‚¹ç›´ä¸‹ã§ãã®Annotationã‚’ä¿æŒã—ã¦ãŠãã€‚
```swift
private var userLocationAnnotationView: MKAnnotationView?

func mapView(
    _ mapView: MKMapView,
    viewFor annotation: MKAnnotation
) -> MKAnnotationView? {
    if annotation is MKUserLocation {
        var userLocationAnnotation = mapView.dequeueReusableAnnotationView(withIdentifier: "userLocation")
        if userLocationAnnotation == nil {
            userLocationAnnotation = MKAnnotationView(annotation: annotation, reuseIdentifier: "userLocation")
        }
        
        let image = UIImage(systemName: "location.north.circle")
        userLocationAnnotation?.image = image
        userLocationAnnotation?.annotation = annotation
        userLocationAnnotation?.frame = .init(x: 0, y: 0, width: 30, height: 30)
        
        self.userLocationAnnotationView = userLocationAnnotation

        return userLocationAnnotation
    }
    
    return nil
}
```

## 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–¹è§’ã‚’å–å¾—ã—ã€ç”»åƒã‚’å›è»¢ã•ã›ã‚‹
CLLocationManagerã®ãƒ‡ãƒªã‚²ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–¹å‘ã‚’å–å¾—ã€‚
```swift
func locationManager(_ manager: CLLocationManager, didUpdateHeading newHeading: CLHeading) {
    // ã‚¯ãƒ©ã‚¹ç›´ä¸‹ã«æ ¼ç´ã—ã¦ãŠã„ãŸç¾åœ¨åœ°ã‚’è¡¨ã™Annotation
    guard let userLocationAnnotationView = userLocationAnnotationView else { return }

    // ãƒ©ã‚¸ã‚¢ãƒ³ã«å¤‰æ›ã—ã€ç”»åƒã‚’å›è»¢
    let angle = CGFloat(newHeading.trueHeading) * .pi / 180
    let transform = CGAffineTransform(rotationAngle: angle)
    userLocationAnnotationView.transform = transform
}
```

# æœ€å¾Œã«
ãƒã‚¤ãƒ³ãƒˆã ã‘èª¬æ˜ã—ã¾ã—ãŸã€‚

å…¨ä½“ãŒç¢ºèªã—ãŸã„æ–¹ã¯ã“ã¡ã‚‰â†“â†“
https://github.com/HikaruKurodq/MKMapViewUserLocation
