---
title: "CryptoKitã§æ–‡å­—åˆ—ã®æš—å·åŒ–ã¨å¾©å·åŒ–ã‚’è¡Œã†"
emoji: "ğŸ˜¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["swift"]
published: true
publication_name: "karabiner_inc"
---

# æš—å·åŒ–
```swift
class CryptoUtil {
    // æš—å·åŒ–
    static func encrypt(string: String, key: SymmetricKey) throws -> Data {
        let data = string.data(using: .utf8)!
        let sealedBox = try AES.GCM.seal(data, using: key)
        return sealedBox.combined!
    }
}
```

# å¾©å·åŒ–
```swift
class CryptoUtil {    
    // å¾©å·åŒ–
    static func decrypt(ciphertext: Data, key: SymmetricKey) throws -> String {
        let sealedBox = try AES.GCM.SealedBox(combined: ciphertext)
        let data = try AES.GCM.open(sealedBox, using: key)
        return String(data: data, encoding: .utf8)!
    }
}
```

# ä½¿ã„æ–¹
```swift
let plainText = "Hello, World!"

// ã‚­ãƒ¼ã®ç”Ÿæˆ
let key = SymmetricKey(size: .bits256)

// æš—å·åŒ–
let cipherText = try CryptoUtil.encrypt(string: plainText, key: key)
print("æš—å·æ–‡", cipherText.base64EncodedString())

// å¾©å·åŒ–
let decrypt = try CryptoUtil.decrypt(ciphertext: cipherText, key: _key)
print("å¾©å·æ–‡", decrypt)
```

# ã‚­ãƒ¼ã®æ–‡å­—åˆ—åŒ–
```swift
extension SymmetricKey {
    
    // Stringå‹ã‹ã‚‰ã‚­ãƒ¼ã«ã™ã‚‹
    init?(base64EncodedString string: String) {
        guard let data = Data(base64Encoded: string) else {
            return nil
        }
        self.init(data: data)
    }

    // ã‚­ãƒ¼ã‚’Stringå‹ã«ã™ã‚‹
    func serialize() -> String {
        return self.withUnsafeBytes { body in
            Data(body).base64EncodedString()
        }
    }
}
```
[ã“ã¡ã‚‰](https://qiita.com/o_mo_te/items/9f4ba6ec867498086165)ã®å¼•ç”¨ã§ã™ã€‚

# SymmetricKeyã¨Stringã®ç›¸äº’å¤‰æ›
```swift
let key = SymmetricKey(size: .bits256)

// ã‚­ãƒ¼ã®æ–‡å­—åˆ—åŒ–
let stringValue = key.serialize()

// æ–‡å­—åˆ—ã‹ã‚‰ã‚­ãƒ¼ã®ç”Ÿæˆ
let _ = SymmetricKey(base64EncodedString: stringValue)!
```
ã‚­ãƒ¼ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã—ã¦ãŠã‹ãªã„ã¨ã€å¾©å·ã§ããªããªã‚‹ã®ã§Stringå‹ã«ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚