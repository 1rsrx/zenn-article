---
title: "WKWebViewã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é‡ã‚’å–å¾—ã™ã‚‹ã¨ãã«ãƒãƒã£ãŸè©±"
emoji: "ğŸ”–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["swift"]
published: true
---
# åˆã‚ã«
WKWebViewã‚’UISrollViewå†…éƒ¨ã«åŸ‹ã‚è¾¼ã‚€å¿…è¦ãŒã‚ã‚Šã€
è¡¨ç¤ºã™ã‚‹ãƒšãƒ¼ã‚¸ã®ä»•æ§˜ä¸Šã€WebViewã®é«˜ã•å–å¾—ã«è‹¦åŠ´ã—ã¾ã—ãŸã€‚

è¡¨ç¤ºã™ã‚‹Webãƒšãƒ¼ã‚¸ãŒé™çš„ãŒé«˜ã•ãŒå›ºå®šãªã®ã§ã‚ã‚Œã°ã€ç°¡å˜ã§ã™ã€‚
ä»Šå›è¡¨ç¤ºã™ã‚‹ã“ã¨ã«ãªã£ãŸWebãƒšãƒ¼ã‚¸ã¯ã€ãƒ­ãƒ¼ãƒ‰å¾Œã«é«˜ã•ãŒå¤‰ã‚ã£ã¦ã„ãŸãŸã‚ã€ç„¡ç†ã‚„ã‚Šå®Ÿè£…ã—ã¾ã—ãŸã€‚

# æ–¹æ³•
(å‰æ: WKWebViewã®scrollView.isScrollEnabledã¯falseã§ã™ã€‚)

## é«˜ã•å›ºå®šã®å ´åˆ
```swift
    override func webView(
        _ webView: WKWebView,
        didFinish navigation: WKNavigation!
    ) {
        // ã“ã‚Œã§å–ã‚Œã¾ã™
        let height = webView.scrollView.contentSize.height
    }
```
ã“ã“ã§å–å¾—ã—ãŸé«˜ã•ã‚’WebViewã®Autolayoutã®åˆ¶ç´„ã‚„frameã«ä½¿ã£ã¦ã‚ã’ã‚Œã°ã€OKã§ã™ã€‚

## ãƒ­ãƒ¼ãƒ‰å¾Œã«é«˜ã•ãŒå¤‰ã‚ã‚‹å ´åˆ
### æ–¹æ³•1: ãƒ•ãƒ­ãƒ³ãƒˆå´ã‹ã‚‰JSé€£æºã§ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’æ•™ãˆã¦ã‚‚ã‚‰ã†
ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒä¸€ç•ªãŠè¡Œå„€ãŒã„ã„ã¨æ€ã„ã¾ã™ç¬‘
ã—ã‹ã—ã€ãƒ•ãƒ­ãƒ³ãƒˆãƒãƒ¼ãƒ ã«ä¾é ¼ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€ç´æœŸã®é–¢ä¿‚ä¸Šé›£ã—ã„ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚

### æ–¹æ³•2: ã‚¿ã‚¤ãƒãƒ¼ã§ç›£è¦–ã™ã‚‹
ç§ã®å ´åˆã¯ã€ã‚¢ãƒ—ãƒªå´ã§å®Œçµã™ã‚‹ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å®Ÿè£…ã—ã¾ã—ãŸã€‚
Webãƒšãƒ¼ã‚¸ã®ä»•æ§˜ã¨ã—ã¦ã¯ã€`webView(_ webView: WKWebView, didFinish navigation: WKNavigation!)`ãŒå®Ÿè¡Œã•ã‚Œã¦1,2ç§’å¾Œã«é«˜ã•ãŒå¤‰ã‚ã£ã¦ã„ãŸã®ã§ã€ã€Œã‚¿ã‚¤ãƒãƒ¼ã§1ç§’ã”ã¨ã«é«˜ã•ã‚’ç¢ºèªã—ã€é«˜ã•ãŒå¤‰ã‚ã£ã¦ã„ã‚Œã°æ›´æ–°ã—ã€ã‚¿ã‚¤ãƒãƒ¼ã¯5ç§’ã§ç ´æ£„ã™ã‚‹ã€ã¨ã„ã†ãƒ­ã‚¸ãƒƒã‚¯ã«ã—ã¾ã—ãŸã€‚
(KVOã§observeã™ã‚‹ã“ã¨ã‚‚è€ƒãˆã¾ã—ãŸãŒã€ç„¡é™ãƒ«ãƒ¼ãƒ—ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šå±é™º)

```swift
class ViewController: UIViewController, WKNavigationDelegate, WKUIDelegate {

    private var webView: WKWebView!

    private var timerToObserveWebViewHeight: Timer?
    private var timerToObserveWebViewHeightCount = 0
    private var timerToObserveWebViewHeightLimit = 5
    private var tmpWebViewHeight = 0

    override func viewDidLoad() {
        super.viewDidLoad()

        webView = WKWebView(frame: .zero, configuration: config)
        webView.scrollView.isScrollEnabled = false
        webView.navigationDelegate = self
        webView.uiDelegate = self

        let url = URL(string: "https://hogehoge-")!
        let request = URLRequest(url: url)
        webView.load(request)
    }

    @objc private func timerToObserveWebViewHeightAction() {
        guard let timer = timerToObserveWebViewHeight else { return }

        if timerToObserveWebViewHeightLimit == timerToObserveWebViewHeightCount {
            timer.invalidate()
            timerToObserveMyPageHeight = nil
            timerToObserveWebViewHeightCount = 0
            tmpWebViewHeight = 0
        }

        let height = webView.scrollView.contentSize.height
    
        // é«˜ã•ãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚Œã°ã€é«˜ã•ã‚’æ›´æ–°ã™ã‚‹
        if height != CGFloat(tmpMyPageHeight) {
            webViewHeightConstraint?.constant = height
            view.layoutIfNeeded()
        }

        tmpWebViewHeight = Int(height)
        timerToObserveWebViewHeightCount += 1
    }

    override func webView(
        _ webView: WKWebView,
        didFinish navigation: WKNavigation!
    ) {
        // ãƒ­ãƒ¼ãƒ‰å¾Œã«ã€é«˜ã•ã‚’ç›£è¦–ã™ã‚‹ã‚¿ã‚¤ãƒãƒ¼ã‚’ç”Ÿæˆã—ã€ã‚¹ã‚¿ãƒ¼ãƒˆ
        timerToObserveMyPageHeight = Timer.scheduledTimer(
                timeInterval: 1,
                target: self,
                selector: #selector(timerToObserveWebViewHeightAction),
                userInfo: nil,
                repeats: true
            )

        timerToObserveMyPageHeight?.fire()
    }
}
```

# çµ‚ã‚ã‚Šã«
ã‚¿ã‚¤ãƒãƒ¼ã§ç„¡ç†ã‚„ã‚Šå®Ÿè£…ã—ãŸã®ã§ã€ä»–ã«ã„ã„æ–¹æ³•ãŒã‚ã‚Œã°æ•™ãˆã¦ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚
ä»Šã®æ¡ˆä»¶ã§ã¯ã€ãƒ­ãƒ¼ãƒ‰å¾Œã®æ•°ç§’ç›£è¦–ã§å¯¾å¿œã§ãã¾ã—ãŸãŒã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒåˆ†ã‹ã‚‰ãªã„å ´åˆã¯ã€ã‚¿ã‚¤ãƒãƒ¼ã‚’å‹•ã‹ã—ç¶šã‘ã‚‹ã“ã¨ã«ãªã‚‹ã®ã§...
