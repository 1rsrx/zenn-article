---
title: "iOSã‚¢ãƒ—ãƒªã‹ã‚‰Qiitaã«æŠ•ç¨¿ã—ã¦ã¿ã‚‹"
emoji: "ğŸ“‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["swift"]
published: false
---

# ã¯ã˜ã‚ã«
HTTPé€šä¿¡ã®GETã«é–¢ã—ã¦ã¯ã€ã‚ˆãä½¿ç”¨ã™ã‚‹ã®ã§ã™ãŒã€POSTã¯ã‚ã¾ã‚Šè§¦ã£ãŸã“ã¨ãŒãªã‹ã£ãŸã®ã§ã€QitiaAPIã§ç·´ç¿’ã—ã¦ã¿ã¾ã—ãŸã€‚

(UIã®å®Ÿè£…ã¯çœç•¥ã—ã¾ã™ã€‚)

# å®Ÿè£…ã™ã‚‹
## ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ç™ºè¡Œ

## ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
### structã®ç”¨æ„
![å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://storage.googleapis.com/zenn-user-upload/f88ace5fa1b2-20221229.png)
POSTã™ã‚‹JSONã«åˆã‚ã›ã¦ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆç”¨ã®æ§‹é€ ä½“ã‚’ä½œæˆã—ã¾ã™ã€‚
```swift
struct PostArticleJSON: Codable {
    var body: String
    var `private`: Bool
    var tags: [Tag]
    var title: String
    var tweet: Bool

    struct Tag: Codable {
        var name: String
        var versions: [String]
    }
}

enum QiitaAPIError: Error, LocalizedError {
    case urlError
    case someError

    var errorDescription: String {
        switch self {
        case .urlError:
            return "URLãŒç„¡åŠ¹"
        case .someError:
            return "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ"
        }
    }
}
```

`coediting`, `group_url_name`ã¯Qiita Teamã§ã®ã¿æœ‰åŠ¹ã®ã‚ˆã†ãªã®ã§ã€ä»Šå›ã¯çœç•¥ã—ã¾ã—ãŸã€‚

### ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ä½œæˆ
```swift
class QiitaAPI {
    private let baseURL = "https://qiita.com/api/v2"

    static func postArticle() async throws {
        guard let url = URL(string: baseURL + "/items") else {
            throw QiitaAPIError.urlError
        }

        var request = URLRequest(url: url)
        request.httpMethod = "POST"
        request.setValue("Bearer {æœ€åˆã«ä½œæˆã—ãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚»ãƒƒãƒˆ}", forHTTPHeaderField: "Authorization")
        request.setValue("application/json", forHTTPHeaderField: "Content-Type")

        let article = PostArticleJSON(
            body: "# ãƒ†ã‚¹ãƒˆ",
            private: true,
            tags: [
                .init(name: "swift", versions: ["0.0.1"]),
            ],
            title: "ã‚¿ã‚¤ãƒˆãƒ«",
            tweet: false
        )
        let httpBody = try! JSONEncoder().encode(article)
        request.httpBody = httpBody
    }
}
```

### é€šä¿¡å‡¦ç†ã®è¿½åŠ 
```swift
class QiitaAPI {
    static let baseURL = "https://qiita.com/api/v2"

    static func postArticle() async throws {
        guard let url = URL(string: baseURL + "/items") else {
            throw QiitaAPIError.urlError
        }

        var request = URLRequest(url: url)
        request.httpMethod = "POST"
        request.setValue("Bearer {æœ€åˆã«ä½œæˆã—ãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚»ãƒƒãƒˆ}", forHTTPHeaderField: "Authorization")
        request.setValue("application/json", forHTTPHeaderField: "Content-Type")

        let article = PostArticleJSON(
            body: "# ãƒ†ã‚¹ãƒˆ",
            private: true, // â† é™å®šå…¬é–‹ã«ã—ã¦ãŠã
            tags: [
                .init(name: "swift", versions: ["0.0.1"]),
            ],
            title: "ã‚¿ã‚¤ãƒˆãƒ«",
            tweet: false
        )
        let httpBody = try! JSONEncoder().encode(article)
        request.httpBody = httpBody

        // è¿½åŠ â†“â†“
        do {
            let (_, response) = try await URLSession.shared.data(for: request)
            guard let httpResponse = response as? HTTPURLResponse else {
                throw QiitaAPIError.someError
            }
            let statusCode = httpResponse.statusCode

            if statusCode != 201 {
                throw QiitaAPIError.someError
            }
        } catch {
            throw QiitaAPIError.someError
        }
    }
}
```

### å®Ÿè¡Œï¼
```swift
class ViewController: UIViewController {

    override func viewDidLoad() {
        super.viewDidLoad()

        Task {
            do {
                try await QiitaAPI.postArticle()
            } catch {
                print("ã‚¨ãƒ©ãƒ¼")
            }
        }
    }
}
```

# æœ€å¾Œã«